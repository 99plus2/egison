(load "lib/tree/xml.egi")

(define $xml1
  <Node "top"
        {<Node "middle1" {<Leaf "text1">
                          <Leaf "text2">
                          <Leaf "text3">
                          <Node "bottom1" {<Leaf "text21">
                                           <Leaf "text100">
                                           <Leaf "text22">}>
                          }>
         <Node "middle2" {<Leaf "text31">
                          <Leaf "text32">
                          <Leaf "text33">
                          <Leaf "text31">
                          <Leaf "text35">
                          }>

         <Node "middle3" {<Leaf "text41">
                          <Leaf "text42">
                          <Node "bottom2" {<Leaf "text51">
                                           <Leaf "text100">
                                           <Leaf "text53">}>
                          <Leaf "text44">
                          <Leaf "text53">
                          }>
         }>)


;; List up all tags.
(test (match-all xml1 xml
        [<descendant <mnode $tag _>
                            _> [tag]]))
; {top middle1 middle2 middle3 bottom1 bottom2}

;; List up all nodes which has more than two same child nodes.
(test (match-all xml1 xml
        [<descendant <mnode $tag <cons $x <cons ,x _>>>>
         [tag x]]))
; {[middle2 <Leaf text31>] [middle2 <Leaf text31>]}

;; List up all nodes which has more than two same descendant nodes.
(test (match-all xml1 xml
        [<descendant
          <mnode $tag
           <cons <descendant $x>
            <cons <descendant ,x>
             _>>>>
         [tag x]]))
; {[middle2 <Leaf text31>] [middle2 <Leaf text31>] [middle3 <Leaf text53>] [middle3 <Leaf text53>] [top <Leaf text100>] [top <Leaf text100>]}



